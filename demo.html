<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>MIDI Parser Demo</title>
	<style>
		body {
			padding: 30px;
			font-family: sans-serif;
			font-size: 18px;
			color: #333;
		}
		a {
			color: #0066ff;
		}
	</style>
</head>
<body>
	<p>Open the console to see the parse-midi module respond to MIDI input.</p>
	<p>Your browser must support the <a href="https://developer.mozilla.org/en-US/docs/Web/API/MIDIAccess">MIDIAccess interface</a>.</p>
	<script src="https://unpkg.com/systemjs@0.21.4/dist/system-production.js"></script>
	<script src="./dist/demoBundle.js"></script>
	<script>
		(async () => {
			// Expose to global scope so users can test in the console
			window.parseMidi = (await SystemJS.import('parseMidi')).default;

			const listenAll = (inputs) => {
				Array.from(inputs.values()).forEach(input => {
					input.onmidimessage = (event) => {
						console.log(JSON.stringify(parseMidi(event.data), null, 4));
					};
				});
			}
			const access = await navigator.requestMIDIAccess();

			if (!access.inputs.size) {
				console.warn('No MIDI devices connected. Connect a device to begin.');
			} else {
				listenAll(access.inputs);
			}

			access.addEventListener('statechange', (event) => {
				const { name, state } = event.port;
				console.log(`${name} is now ${state}`);

				if (state === 'connected') {
					listenAll(event.target.inputs);
				}
			});
		})();
	</script>
</body>
</html>
